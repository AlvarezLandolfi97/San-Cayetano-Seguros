# Frontend ↔ Backend Contract

Resumen de todos los endpoints que consume el frontend (`src/**`). Cada fila indica el archivo/linea, el método, la ruta completa (con `/api`), si el endpoint todavía existe o es legacy, la recomendación específica y el riesgo de autenticación.

| Archivo y línea donde se llama | Método | Path completo (con `/api`) | Requires Auth (front) | ¿Existe o parece legacy? | Recomendación concreta | Riesgo de auth (public/hybrid/private) |
| --- | --- | --- | --- | --- | --- | --- |
| `frontend/src/hooks/useAuth.js:61`, `frontend/src/pages/dashboard/Profile.jsx:27` | GET | `/api/accounts/users/me` | `true` | Sí, `UserViewSet.me` (permiso `IsAuthenticated`). | Mantener la consulta inicial y convertir 401/403 en logout/redirect para evitar datos stale. | private |
| `frontend/src/pages/dashboard/Profile.jsx:72` | PUT | `/api/accounts/users/me` | `true` | Sí, la misma acción acepta PATCH/PUT (IsAuthenticated). | Seguir enviando `birth_date` como `null` cuando está vacío y mostrar errores de validación 400. | private |
| `frontend/src/hooks/useAuth.js:94` | POST | `/api/auth/login` | `false` | Sí, `EmailLoginView`. | Mantener; el backend ya retorna `require_otp` y tokens. | public |
| `frontend/src/hooks/useAuth.js:114` | POST | `/api/auth/google` | `false` | Sí, `GoogleLoginView`. | Mantener y propagar errores/2FA que el backend devuelva. | public |
| `frontend/src/hooks/useAuth.js:121` | POST | `/api/auth/register` | `false` | Sí, `RegisterView`. | Mantener y normalizar al user si el backend devuelve datos adicionales. | public |
| `frontend/src/hooks/useAuth.js:138` | POST | `/api/auth/refresh` | `false` (refresh token enviado en body) | Sí, `TokenRefreshView`. | Seguir usando para revalidar y forzar logout cuando no haya refresh. | private |
| `frontend/src/pages/Logout.jsx:15` | POST | `/api/auth/logout` | `false` | Sí, `LogoutView`. | Llamada opcional; igual limpiá tokens locales aunque falle el logout server. | private |
| `frontend/src/pages/ResetRequest.jsx:21` | POST | `/api/auth/password/reset` | `false` | Sí, `PasswordResetRequestView`. | Mantener y mostrar el detalle del backend cuando devuelve `detail`. | public |
| `frontend/src/pages/ResetConfirm.jsx:41` | POST | `/api/auth/password/reset/confirm` | `false` | Sí, `PasswordResetConfirmView`. | Mantener y traducir errores de token expirado (410) a un mensaje claro. | public |
| `frontend/src/pages/Home.jsx:39` | GET | `/api/products/home` | `false` | Sí, `HomeProductsListView` (PublicEndpointMixin). | Mantener como primer intento; si está vacío, pasar al fallback. | public |
| `frontend/src/pages/Home.jsx:46` | GET | `/api/products/` | `false` | Sí, `ProductViewSet.list` (AllowAny para `list`). | Mantener como respaldo y filtrar/normalizar `results`. | public |
| `frontend/src/components/home/ContactSection.jsx:20` | GET | `/api/common/contact-info/` | `false` | Sí, `ContactInfoView.get` (AllowAny + OptionalAuthentication). | Mantener y sobreescribir el fallback si hay datos. | public |
| `frontend/src/pages/admin/ContactInfo.jsx:25` | GET | `/api/common/contact-info/` | `true` | Sí, `ContactInfoView.get` (AllowAny + OptionalAuthentication). | Esta vista admin también consulta el mismo recurso; mantener la autenticación. | private |
| `frontend/src/pages/admin/ContactInfo.jsx:51` | PATCH | `/api/common/contact-info/` | `true` | Sí, `ContactInfoView.patch`, actualmente también `AllowAny`. | Confirmar que solo admins autenticados ven esta UI; idealmente el backend debería agregar `IsAdminUser`. | private |
| `frontend/src/components/ui/AnnouncementBar.jsx:15` | GET | `/api/common/announcements` | `false` | Canonical endpoint, ya no depende del legacy redirect. | Usar `apiPublic` y evitar `/api/announcements/`. | public |
| `frontend/src/services/quoteShare.js:4` | POST | `/api/quotes/share` | `false` | Sí, `QuoteShareCreateView` (PublicEndpointMixin). | Mantener la creación del token compartido (200/201). | public |
| `frontend/src/services/quoteShare.js:9` | GET | `/api/quotes/share/{token}` | `false` | Sí, `QuoteShareDetailView` (PublicEndpointMixin). | Mantener manejando 410 cuando el share expiró. | public |
| `frontend/src/services/policyService.js:31`, `frontend/src/pages/dashboard/Payments.jsx:37`, `frontend/src/pages/dashboard/PolicyOverview.jsx:53` | GET | `/api/policies/my` | `true` | Sí, `PolicyViewSet.my` (IsAuthenticated). | Mantener para cargar todas las pólizas del usuario y refrescar en segundo plano. | private |
| `frontend/src/services/policyService.js:41`, `frontend/src/pages/PolicyDetail.jsx:19`, `frontend/src/pages/dashboard/Payments.jsx:48`, `frontend/src/pages/dashboard/PolicyOverview.jsx:67` | GET | `/api/policies/{id}` | `true` | Sí, `PolicyViewSet.retrieve` (IsOwnerOrAdmin). | Mantener y mostrar 401/403 con mensaje que sugiera login. | private |
| `frontend/src/pages/PolicyDetail.jsx:20`, `frontend/src/pages/dashboard/Payments.jsx:50`, `frontend/src/pages/dashboard/PolicyOverview.jsx:71`, `frontend/src/pages/admin/Policies.jsx:964` | GET | `/api/policies/{id}/receipts` | `true` | Sí, `PolicyViewSet.receipts` (IsOwnerOrAdmin). | Mantener para listar comprobantes y refrescar luego de pagos. | private |
| `frontend/src/pages/dashboard/Payments.jsx:49,103`, `frontend/src/pages/dashboard/PolicyOverview.jsx:68,134`, `frontend/src/pages/admin/Policies.jsx:963` | GET | `/api/payments/pending` | `true` | Sí, `PaymentViewSet.pending` (IsAuthenticated + propiedad del policy). | Mantener y aprovechar los mensajes de `start_date`/`premium` que el backend devuelve. | private |
| `frontend/src/services/payments.js:9`, `frontend/src/pages/dashboard/Payments.jsx:145`, `frontend/src/pages/dashboard/PolicyOverview.jsx:127` | POST | `/api/payments/policies/{policyId}/create_preference` | `true` | Sí, `PaymentViewSet.create_preference` (IsAuthenticated). | Pasar siempre `installment_id` y refrescar `pending` tras abrir Mercado Pago. | private |
| `frontend/src/services/payments.js:34` | GET | `/api/payments` | `true` | Sí, `PaymentViewSet.list` (solo admins). | El helper ya atrapa 403/404; mantener como respaldo para vistas admin. | private |
| `frontend/src/services/payments.js:47` | GET | `/api/payments/{paymentId}` | `true` | Sí, `PaymentViewSet.retrieve` (admin). | Mantener solo para admins; el helper también silencia errores 403. | private |
| `frontend/src/pages/admin/Policies.jsx:653, 937, 1032` | POST | `/api/payments/manual/{policyId}` | `true` | Sí, `manual_payment` con `IsAdminUser`. | Mantener pero condicionarlo a que el backend permita pagos manuales; mostrar error si devuelve 403. | private |
| `frontend/src/api/policies.js:4`, `frontend/src/pages/dashboard/ClaimPolicy.jsx:39` | POST | `/api/policies/claim` | `true` | Sí, `PolicyViewSet.claim` (IsAuthenticated). | Mantener y mostrar los mensajes de error 404/400 que el backend devuelve. | private |
| `frontend/src/pages/admin/Users.jsx:121`, `frontend/src/pages/admin/AdminHome.jsx:50`, `frontend/src/pages/admin/Policies.jsx:172` | GET | `/api/admin/policies` | `true` | Sí, `AdminPolicyViewSet.list` (IsAdminUser). | Mantener para paneles y filtros admin; paginar a 200 y repetir hasta `next`. | private |
| `frontend/src/pages/admin/Policies.jsx:903` | POST | `/api/admin/policies` | `true` | Sí, `AdminPolicyViewSet.create`. | Mantener y refrescar la lista cuando se crea una nueva póliza. | private |
| `frontend/src/pages/admin/Policies.jsx:645, 1028, 1062, 1084`, `frontend/src/pages/admin/Users.jsx:298, 313` | PATCH | `/api/admin/policies/{id}` | `true` | Sí, `AdminPolicyViewSet.update/partial` (IsAdminUser). | Mantener para inline edits, reasignaciones y soft delete/restauración. | private |
| `frontend/src/pages/admin/Users.jsx:139`, `frontend/src/pages/admin/Policies.jsx:314` | GET | `/api/admin/users` | `true` | Sí, `UserViewSet` list en admin. | Mantener y paginar (ya lo hace). | private |
| `frontend/src/pages/admin/Users.jsx:351` | POST | `/api/admin/users` | `true` | Sí, `UserViewSet.create`. | Mantener y liberar los errores que el backend devuelve para correos repetidos. | private |
| `frontend/src/pages/admin/Users.jsx:267, 283, 349, 378, 406`, `frontend/src/pages/admin/AdminHome.jsx:132` | PATCH | `/api/admin/users/{id}` | `true` | Sí, `UserViewSet` update/partial (IsAdminUser/IsSelf). | Mantener para cambios de estado y datos; la UI ya resetea después de cada llamada. | private |
| `frontend/src/pages/admin/AdminHome.jsx:70`, `frontend/src/pages/admin/Policies.jsx:345` | GET | `/api/common/admin/settings/` | `true` | Sí, `AppSettingsView` (IsAdminUser). | Mantener para llenar los campos y ajustar conteos luego de cargar. | private |
| `frontend/src/pages/admin/AdminHome.jsx:147` | PATCH | `/api/common/admin/settings/` | `true` | Sí, `AppSettingsView.patch`. | Mantener y recargar `loadHomeData` al terminar. | private |
| `frontend/src/pages/admin/InsuranceTypes.jsx:24`, `frontend/src/pages/admin/Policies.jsx:324` | GET | `/api/admin/insurance-types` | `true` | Sí, `ProductAdminViewSet.list` (IsAdminUser). | Mantener para mostrar seguros y dropdowns; ya filtra `results`. | private |
| `frontend/src/pages/admin/InsuranceTypes.jsx:84` | POST | `/api/admin/insurance-types` | `true` | Sí, `ProductAdminViewSet.create`. | Mantener y vaciar el form tras creación. | private |
| `frontend/src/pages/admin/InsuranceTypes.jsx:77, 122, 145, 376` | PATCH | `/api/admin/insurance-types/{id}` | `true` | Sí, `ProductAdminViewSet.update/partial` (IsAdminUser). | Mantener para inline updates y toggles de `is_active`. | private |

**Notas:** usa `apiPublic` (o `apiHybrid` si necesitás enviar `Authorization` opcionalmente) para los endpoints etiquetados como `false` en `Requires Auth (front)`; la instancia base `api` conserva el comportamiento tradicional para los privados/que requieren refresh inmediato. No consumas `/api/announcements/`; la ruta canónica es `/api/common/announcements`. Los callers escriben paths sin trailing slash y `api.js` los normaliza agregando `/` antes de enviarlos a DRF.
